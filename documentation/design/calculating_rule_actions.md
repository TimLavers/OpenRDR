# Calculating the rule actions from changes made to the interpretive report

## What is a rule action?

A rule comprises of an action and a set of boolean conditions.  
The conditions are evaluated against the data in the case, and if all are true, the action of the rule is applied.
The action defines the change made to the interpretation by that rule

In this example domain, the possible rule actions are limited to:

- Adding a sentence
- Removing a sentence
- Replacing one sentence with another sentence

The list of all sentences given by the rules in the knowledge base forms the interpretive report for each case.

## What is the approved report?

When the expert reviews the interpretive report, they may decide that some of the sentences are not appropriate for this
particular case,
and so they remove or replace them. They may also decide that some sentences are missing, and so they add them.

This user-changed report is the approved report for the case, and it will differ from the report generated by the
current set of rules.

However, these changes will only apply to the current case.
To teach the system how to generate the approved report for other cases like this one,
the user will need to add the corresponding rules to the knowledge base.

## How to determine the rule actions from these changes?

To determine the rule actions corresponding to the changes that the user has made, we need to compare the approved
report with the original, interpretive report.

To do this, we use a text difference algorithm based on
the [The Myers difference algorithm.](https://www.nathaniel.ai/myers-diff/#:~:text=In%201986%2C%20Eugene%20Myers%20published,transforming%20one%20sequence%20into%20another.)
where the sentences are the atomic units of comparison, rather than words or characters.

The steps are as follows:

1. Split the approved report into sentences using the period + space characters as the delimiter.
2. The interpretive report is already split into sentences.
3. Map each sentence in the approved report to an alphabetic character, e.g. A, B, C, etc, so that the approved report
   is represented as a list of single-digit characters. (We assume in this domain that there are at most 26 unique
   sentences in any report. The algorithm can be easily extended if this assumption is not true for some domain.)
4. Do the same for the sentences in the interpretive report.
5. Use the Myers algorithm to determine the differences between the two lists of characters. The implementation in this
   project is based on
   the [Java diff Utilities](https://mvnrepository.com/artifact/io.github.java-diff-utils/java-diff-utils)
6. The algorithm returns a list of rows, with each row containing 1, 2 or 4 characters as follows:
   - A row with a single character, e.g. "A" means that the sentence corresponding to A in the original report was not
     changed.
   - A row with two characters is of the form +A or -A which means that the sentence corresponding to A was added or
     removed respectively.
   - A row with four characters is of the form +A-B which means that the sentence corresponding to A was replaced by the
     sentence corresponding to B.





